<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surprise untuk Sayang ‚ù§Ô∏è</title>
<style>
    body {
        margin: 0;
        font-family: monospace;
        background-color: black;
        color: white;
        text-align: center;
        overflow: hidden;
    }
    .section {
        display: none;
        height: 100vh;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    .show {
        display: flex;
    }
    pre {
        background: #111;
        padding: 20px;
        border-radius: 10px;
        color: #0f0;
        text-align: left;
        max-width: 90%;
        overflow: auto;
        white-space: pre-wrap;
    }
    button {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 18px;
        background: crimson;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    button:disabled {
        background: gray;
        cursor: not-allowed;
    }
    .countdown {
        font-size: 200px;
        font-weight: bold;
        animation: scaleUp 0.5s ease-in-out;
    }
    @keyframes scaleUp {
        from { transform: scale(0.5); opacity: 0.5; }
        to { transform: scale(1); opacity: 1; }
    }
    .lyrics {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        text-align: center;
        font-size: 28px;
        background: rgba(0,0,0,0.4);
        padding: 10px;
        font-family: sans-serif;
        z-index: 1000;
    }
    @media (max-width: 768px) {
        .lyrics {
            font-size: 20px;
            padding: 8px;
        }
    }
    .random-photo {
        position: absolute;
        border: none;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.5);
        opacity: 0;
        z-index: 900;
        animation: fadeInOut 5s ease-in-out forwards, floatWiggle 3s ease-in-out infinite;
    }
    @keyframes fadeInOut {
        0% { opacity: 0; }
        15% { opacity: 1; }
        85% { opacity: 1; }
        100% { opacity: 0; }
    }
    @keyframes floatUp {
        0% { transform: translateY(0) scale(1); opacity: 1; }
        100% { transform: translateY(-250px) scale(1.5); opacity: 0; }
    }
    .love-kiss {
        position: fixed;
        bottom: 0;
        animation: floatUp 3s ease-out forwards;
        pointer-events: none;
        z-index: 999;
        user-select: none;
    }
    @keyframes floatWiggle {
        0% { transform: rotate(var(--rotasi)) translateY(0); }
        25% { transform: rotate(calc(var(--rotasi) + 2deg)) translateY(-3px); }
        50% { transform: rotate(var(--rotasi)) translateY(0); }
        75% { transform: rotate(calc(var(--rotasi) - 2deg)) translateY(3px); }
        100% { transform: rotate(var(--rotasi)) translateY(0); }
    }
</style>
</head>
<body>

<div id="page1" class="section show">
    <pre id="code-display"></pre>
    <button id="generateBtn" onclick="startCountdown()" disabled>Generate</button>
</div>

<div id="page2" class="section">
    <div class="countdown" id="countdown">3</div>
    <audio id="tick-sound" src="https://ik.imagekit.io/qple93f0pk/short-beep-countdown-81121.mp3"></audio>
</div>

<div id="page3" class="section">
    <h1>Hi sayang ‚ù§Ô∏è</h1>
    <button onclick="showMain()">Buka Halaman</button>
</div>

<div id="page4" class="section">
    <audio id="bg-music"></audio>
    <div id="slideshow"></div>
    <div class="lyrics" id="lyrics"></div>
</div>

<script>
let codeText = `// Skrip rahasia untuk seseorang yang spesial üíñ
function sayang() {
    let nama = "Sayangku";
    let perasaan = "Bahagia";
    console.log("Halo " + nama + " ‚ù§Ô∏è");
    console.log("Kamu adalah alasan aku " + perasaan + " setiap hari.");
    
    let janji = [
        "Menjagamu selalu",
        "Membuatmu tersenyum",
        "Mendukungmu apapun yang terjadi",
        "Menyayangimu selamanya"
    ];
    
    for (let i = 0; i < janji.length; i++) {
        console.log("Janji #" + (i+1) + ": " + janji[i]);
    }
    
    let pesan = "Ini cuma untukmu...";
    console.log(pesan);
}

sayang();

setTimeout(() => {
    console.log("Loading perasaan...");
}, 1000);

setTimeout(() => {
    console.log("‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è");
}, 2000);

// Script selesai, klik tombol Generate untuk melanjutkan
`;

let i = 0;
function typeCode() {
    if (i < codeText.length) {
        document.getElementById("code-display").innerHTML += codeText.charAt(i);
        i++;
        setTimeout(typeCode, 20);
    } else {
        document.getElementById("generateBtn").disabled = false;
    }
}
typeCode();

function startCountdown() {
    document.getElementById("page1").classList.remove("show");
    document.getElementById("page2").classList.add("show");
    let count = 3;
    let timer = setInterval(() => {
        document.getElementById("tick-sound").play();
        document.getElementById("countdown").innerText = count;
        document.getElementById("countdown").style.animation = "none";
        setTimeout(() => {
            document.getElementById("countdown").style.animation = "scaleUp 0.5s ease-in-out";
        }, 10);
        count--;
        if (count < 0) {
            clearInterval(timer);
            document.getElementById("page2").classList.remove("show");
            document.getElementById("page3").classList.add("show");
        }
    }, 1000);
}

function showMain() {
    document.getElementById("page3").classList.remove("show");
    document.getElementById("page4").classList.add("show");

    document.getElementById("page4").style.backgroundImage = 
        "url('https://ik.imagekit.io/qple93f0pk/IMG-20250724-WA0024.jpg')";
    document.getElementById("page4").style.backgroundSize = "cover";
    document.getElementById("page4").style.backgroundPosition = "center";

    let bgMusic = document.getElementById("bg-music");
    bgMusic.src = "https://ik.imagekit.io/qple93f0pk/Stephen_Sanchez_-_Until_I_Found_You.mp3";
    bgMusic.play();

    startLoveKiss();

    fetch("https://ik.imagekit.io/qple93f0pk/Stephen_Sanchez_-_Until_I_Found_You.srt?updatedAt=1755163782006")
    .then(res => res.text())
    .then(srtText => {
        let lirikData = parseSRT(srtText);
        syncLyrics(lirikData, bgMusic);
    });

    let fotoCount = 35;
    let fotoList = [];
    for (let i = 1; i <= fotoCount; i++) {
        fotoList.push(`foto/foto${i}.jpg`);
    }

    setInterval(() => {
        spawnRandomPhoto(fotoList);
    }, 5000);
}

let fotoIndexShuffle = [];
let activePhotos = [];

function spawnRandomPhoto(fotoList) {
    if (fotoIndexShuffle.length === 0) {
        fotoIndexShuffle = [...Array(fotoList.length).keys()]
            .sort(() => Math.random() - 0.5);
    }
    let idx = fotoIndexShuffle.shift();
    let img = document.createElement("img");
    img.src = fotoList[idx];
    img.classList.add("random-photo");

    let size = Math.floor(Math.random() * (250 - 120 + 1)) + 120;
    img.style.width = size + "px";

    let posLeft, posTop, attempts = 0;
    do {
        posLeft = Math.random() * (window.innerWidth - size);
        posTop = Math.random() * (window.innerHeight - size - 100);
        attempts++;
    } while (checkOverlap(posLeft, posTop, size) && attempts < 20);

    img.style.left = posLeft + "px";
    img.style.top = posTop + "px";

    let rotasi = (Math.random() * 30 - 15) + "deg";
    img.style.setProperty("--rotasi", rotasi);

    document.body.appendChild(img);
    activePhotos.push({ left: posLeft, top: posTop, size: size });

    setTimeout(() => {
        img.remove();
        activePhotos = activePhotos.filter(p => !(p.left === posLeft && p.top === posTop));
    }, 5000);
}

function checkOverlap(left, top, size) {
    return activePhotos.some(p => {
        return !(left + size < p.left || left > p.left + p.size ||
                 top + size < p.top || top > p.top + p.size);
    });
}

function parseSRT(srt) {
    let pattern = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\n|\n*$)/g;
    let result = [];
    let match;
    while ((match = pattern.exec(srt)) !== null) {
        result.push({
            start: timeToSeconds(match[2]),
            end: timeToSeconds(match[3]),
            text: match[4].replace(/\n/g, " ")
        });
    }
    return result;
}

function timeToSeconds(time) {
    let [h, m, rest] = time.split(":");
    let [s, ms] = rest.split(",");
    return (+h) * 3600 + (+m) * 60 + (+s) + (+ms)/1000;
}

function syncLyrics(lirikData, audio) {
    let lyricDiv = document.getElementById("lyrics");
    setInterval(() => {
        let currentTime = audio.currentTime;
        let currentLine = lirikData.find(l => currentTime >= l.start && currentTime <= l.end);
        lyricDiv.innerText = currentLine ? currentLine.text : "";
    }, 200);
}

function startLoveKiss() {
    setInterval(() => {
        let el = document.createElement("div");
        el.classList.add("love-kiss");
        el.textContent = Math.random() > 0.5 ? "‚ù§Ô∏è" : "üíã";
        let size = Math.floor(Math.random() * 30) + 20;
        el.style.fontSize = size + "px";
        let posX = Math.random() * (window.innerWidth - 50);
        el.style.left = posX + "px";
        let duration = (Math.random() * 2) + 2;
        el.style.animationDuration = duration + "s";
        document.body.appendChild(el);
        setTimeout(() => el.remove(), duration * 1000);
    }, 500);
}
</script>

</body>
</html>
